apiVersion: magalix.com/v1
kind: Policy
metadata:
  name: magalix.templates.mariadb-enforce-environment-variable
spec:
  id: magalix.templates.mariadb-enforce-environment-variable
  name: Mariadb Enforce Environment Variable
  description: |
    This Policy checks for the following environment variables for your MariaDB deployments using the official Docker image. 
    ### MARIADB_USER
    The MARIADB_USER environment variable sets up a superuser with the same name. 
    ### MARIADB_ROOT_PASSWORD
    The MARIADB_ROOT_PASSWORD environment variable specifies a password for the MARIADB root account. 
    ### MARIADB_PASSWORD
    The MARIADB_PASSWORD environment variable specifies a password for MARIADB_USER user. 
    ### MARIADB_RANDOM_ROOT_PASSWORD
    The MARIADB_RANDOM_ROOT_PASSWORD environment variable creates random password for the server's root user when the Docker container is started.
  how_to_solve: |
    If you encounter a violation, ensure one of the following environment variables is set. 
    - MARIADB_USER
    - MARIADB_ROOT_PASSWORD
    - MARIADB_PASSWORD
    - MARIADB_RANDOM_ROOT_PASSWORD

    For futher information about the MariaDB Docker container, check here: https://hub.docker.com/_/mariadb
  category: magalix.categories.access-control
  severity: high
  controls:
  - magalix.controls.pci-dss.2.1
  - magalix.controls.hipaa.164.312.a.2.i
  - magalix.controls.gdpr.25
  - magalix.controls.gdpr.32
  - magalix.controls.gdpr.24
  - magalix.controls.hipaa.164.312.a.1
  parameters:
  - name: envvar_name
    type: string
    required: true
    default:
  - name: app_name
    type: string
    required: true
    default:
  - name: exclude_namespace
    type: string
    required: false
    default:
  - name: exclude_label_key
    type: string
    required: false
    default:
  - name: exclude_label_value
    type: string
    required: false
    default:
