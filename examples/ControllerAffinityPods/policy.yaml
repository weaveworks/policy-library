enable: true
name: magalix.policies.affinity-pod-simple
description: |
  This Policy sets podAffinity keys, regardless of the Pod Affinity scheduling type. List out the keys you want to check for. This Policy supports the following Pod Affinity types:
  - preferredDuringSchedulingIgnoredDuringExecution 
  - requiredDuringSchedulingIgnoredDuringExecution 
how_to_solve: |
  When working with pod affinity, this Policy will traverse through the entity and find the proper keys, regardless of pod affinity type. The follwing is an example of where the key is located. 
  ```
  ...
    spec:
      affinity:
        podAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
              - key: <keys>
  ```
  https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/
  https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#PodAffinity
category: magalix.categories.capacity-management
severity: medium
controls:
- magalix.controls.soc2-type1.2.1.1
parameters:
- name: keys
  type: array
  required: true
  default:
- name: exclude_namespace
  type: string
  required: false
  default:
- name: exclude_label_key
  type: string
  required: false
  default:
- name: exclude_label_value
  type: string
  required: false
  default:
