apiVersion: pac.weave.works/v2beta1
kind: Policy
metadata:
  name: weave.templates.affinity-node-simple
spec:
  id: weave.templates.affinity-node-simple
  name: Affinity Node Simple
  description: |
    This Policy sets NodeAffinity keys, regardless of the Node Affinity selector or scheduling type. List out the keys you want to check to ensure you are using the right keys. This Policy supports the following Node Affinity types:
    - preferredDuringSchedulingIgnoredDuringExecution
    - requiredDuringSchedulingIgnoredDuringExecution
  how_to_solve: |
    When working with Node Affinity, this policy will traverse through the entity and find the proper keys, regardless of affinity type. The follwing is an example of where the key is located. 

    ```
    ...
      spec:
        affinity:
          nodeAffinity:
            requiredDuringSchedulingIgnoredDuringExecution:
              nodeSelectorTerms:
              - matchExpressions:
                - key: <keys>
    ```

    https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/
  category: weave.categories.capacity-management
  severity: medium
  standards:
  - id: weave.standards.soc2-type-i
    controls:
    - weave.controls.soc2-type-i.2.1.1
  parameters:
  - name: keys
    type: array
    required: true
    value:
  - name: exclude_namespace
    type: string
    required: false
    value:
  - name: exclude_label_key
    type: string
    required: false
    value:
  - name: exclude_label_value
    type: string
    required: false
    value:
