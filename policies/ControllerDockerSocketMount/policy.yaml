apiVersion: pac.weave.works/v2beta1
kind: Policy
metadata:
  name: weave.policies.containers-mounting-docker-socket
spec:
  id: weave.policies.containers-mounting-docker-socket
  name: Containers Mounting Docker Socket
  enabled: false
  description: |
    This Policy checks the mounting of the `docker.sock` socket of the node into the container. The docker socket filename can be altered based on your configuration. The full path is unnecessary as the Policy accounts for any path.  
  how_to_solve: |
    Ensure workloads aren't mounting the `docker.sock` (or other configured socket name) in order to avoid a violation. 
    ```
    ...
      spec:
        template:
          spec:
            volumes:
              - name: docker-sock
                hostPath:
                  path: "<path>/<this value>"
                  type: File
    ```
  category: weave.categories.pod-security
  severity: high
  targets: {kinds: [Deployment, Job, ReplicationController, ReplicaSet, DaemonSet,
      StatefulSet, CronJob]}
  standards:
  - id: weave.standards.nist-800-190
    controls:
    - weave.controls.nist-800-190.4.4.3
  - id: weave.standards.gdpr
    controls:
    - weave.controls.gdpr.25
    - weave.controls.gdpr.32
    - weave.controls.gdpr.24
  tags: [nist800-190, gdpr, default]
  parameters:
  - name: docker_sock
    type: string
    required: true
    value: docker.sock
  - name: exclude_namespace
    type: string
    required: false
    value:
  - name: exclude_label_key
    type: string
    required: false
    value:
  - name: exclude_label_value
    type: string
    required: false
    value:
