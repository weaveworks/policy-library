apiVersion: pac.weave.works/v2beta1
kind: Policy
metadata:
  name: weave.policies.container-running-as-root
spec:
  id: weave.policies.container-running-as-root
  name: Container Running As Root
  enabled: true
  description: |
    Running as root gives the container full access to all resources in the VM it is running on. Containers should not run with such access rights unless required by design. This Policy enforces that the `securityContext.runAsNonRoot` attribute is set to `true`. 
  how_to_solve: |
    You should set `securityContext.runAsNonRoot` to `true`. Not setting it will default to giving the container root user rights on the VM that it is running on. 
    ```
    ...
      spec:
        securityContext:
          runAsNonRoot: true
    ```
    https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
  category: weave.categories.pod-security
  severity: high
  targets: {kinds: [Deployment, Job, ReplicationController, ReplicaSet, DaemonSet,
      StatefulSet, CronJob]}
  standards:
  - id: weave.standards.pci-dss
    controls:
    - weave.controls.pci-dss.2.2.4
    - weave.controls.pci-dss.2.2.5
  - id: weave.standards.cis-benchmark
    controls:
    - weave.controls.cis-benchmark.5.2.6
  - id: weave.standards.mitre-attack
    controls:
    - weave.controls.mitre-attack.4.1
  - id: weave.standards.nist-800-190
    controls:
    - weave.controls.nist-800-190.3.3.1
  - id: weave.standards.gdpr
    controls:
    - weave.controls.gdpr.24
    - weave.controls.gdpr.25
    - weave.controls.gdpr.32
  tags: [pci-dss, cis-benchmark, mitre-attack, nist800-190, gdpr, default]
  parameters:
  - name: exclude_namespace
    type: string
    required: false
    value: kube-system
  - name: exclude_label_key
    type: string
    required: false
    value:
  - name: exclude_label_value
    type: string
    required: false
    value:
