apiVersion: weaveworks.com/v1
kind: Policy
metadata:
  name: magalix.policies.prohibit-creating-namespace-starting-with-prefix
spec:
  enable: true
  name: magalix.policies.prohibit-creating-namespace-starting-with-prefix
  description: |
    Using this Policy, you can prohibit certain namespaces from containing a specified combination of letters and/or numbers. 
  how_to_solve: |
    Specify a `namespace` that is something other than what is listed in the Policy. 
    ```
    metadata:
      name: <namespace_name>
    ```
    https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/#working-with-namespaces
  category: magalix.categories.organizational-standards
  severity: medium
  targets: {kind: [Namespace]}
  tags: []
  parameters:
  - name: namespace_name
    type: string
    required: true
    default: kube-
  code: "package magalix.advisor.namespace.prohibit\n\nnamespace_name := input.parameters.namespace_name\n\
    \nviolation[result] {\n\tname := namespace_input.metadata.name\n  startswith(name,\
    \ namespace_name)\n  result = {\n  \t\"issue detected\": true,\n    \"msg\": sprintf(\"\
    Namespaces should not start with '%v'; you have specified '%v'\", [namespace_name,\
    \ name]),\n    \"violating_key\": \"metadata.name\"\n  }\n}\n\nnamespace_input\
    \ = input.review.object {\n  contains_kind(input.review.object.kind, {\"Namespace\"\
    })\n} \n\ncontains_kind(kind, kinds) {\n  kinds[_] = kind\n}\n"
