apiVersion: pac.weave.works/v1
kind: Policy
metadata:
  name: weave.policies.rabbitmq-enforce-mnesia-base-env-var
spec:
  id: weave.policies.rabbitmq-enforce-mnesia-base-env-var
  name: RabbitMQ Enforce Environment Variable - RABBITMQ_MNESIA_BASE
  description: |
    This Policy ensures RABBITMQ_MNESIA_BASE environment variable are in place when using the official container images from Docker Hub.
    RABBITMQ_MNESIA_BASE: This base directory contains sub-directories for the RabbitMQ server's node database, message store and cluster state files, one for each node, unless RABBITMQ_MNESIA_DIR is set explicitly. It is important that effective RabbitMQ user has sufficient permissions to read, write and create files and subdirectories in this directory at any time. This variable is typically not overridden. Usually RABBITMQ_MNESIA_DIR is overridden instead.
  how_to_solve: |
    If you encounter a violation, ensure the RABBITMQ_MNESIA_BASE environment variables is set.
    For futher information about the RabbitMQ Docker container, check here: https://hub.docker.com/_/rabbitmq
  category: weave.categories.organizational-standards
  severity: high
  targets: {kinds: [Deployment, Job, ReplicationController, ReplicaSet, DaemonSet,
    StatefulSet, CronJob]}
  parameters:
  - value: 
    name: exclude_namespace
    required: false
    type: string
  - value: 
    name: exclude_label_key
    required: false
    type: string
  - value: 
    name: exclude_label_value
    required: false
    type: string

