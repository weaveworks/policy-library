apiVersion: magalix.com/v1
kind: Policy
metadata:
  name: magalix.policies.postgres-enforce-password-env-var
spec:
  id: magalix.policies.postgres-enforce-password-env-var
  name: Postgres Enforce Environment Variable - POSTGRES_PASSWORD
  description: |
    This Policy ensures POSTGRES_PASSWORD environment variable are in place when using the official container images from Docker Hub.
    POSTGRES_PASSWORD:   The POSTGRES_PASSWORD environment variable is required for you to use the PostgreSQL image. It must not be empty or undefined. This environment variable sets the superuser password for PostgreSQL. The default superuser is defined by the POSTGRES_USER environment variable.
  how_to_solve: |
    If you encounter a violation, ensure the POSTGRES_PASSWORD environment variables is set.
    For futher information about the Postgres Docker container, check here: https://hub.docker.com/_/postgres
  category: magalix.categories.access-control
  severity: high
  controls:
  - magalix.controls.hipaa.164.312.a.1
  - magalix.controls.hipaa.164.312.a.2.i
  - magalix.controls.gdpr.24
  - magalix.controls.gdpr.25
  - magalix.controls.gdpr.32
  targets: {kind: [Deployment, Job, ReplicationController, ReplicaSet, DaemonSet,
    StatefulSet, CronJob]}
  tags: [
    "pci-dss",
    "mitre-attack",
    "hipaa",
    "gdpr",
  ]
  parameters:
  - default: 
    name: exclude_namespace
    required: false
    type: string
  - default: 
    name: exclude_label_key
    required: false
    type: string
  - default: 
    name: exclude_label_value
    required: false
    type: string

